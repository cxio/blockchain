### P2P逻辑

1. 不信任协作
    - 除非对端明确要求，否则不转达第三方的回馈。
    - 通常，一端不应当要求另一端转达第三方的信息，除非程序逻辑本来如此。

2. 惰性传播
    - 当无法提供服务或结果时，不应当自动转达对端的请求给第三方。
    - 需要对端自动转发请求时应当明确指示。但更好的做法是更换对端。

3. 最短路径
    - 如果对端不能提供服务或需要的结果，应当积极寻求其它的对端帮助。
    - 交互应遵循最短路径或最少中间环节的原则。

理由：
1. 最大限度减少P2P网络信息流量，提高有效信息的比例。
2. 增加连接的变化量，提高动态性，增强网络自洽及整体的鲁棒性。



### 编码准则

1. 最细粒度。
    拆解到事物的最基本逻辑单元。

2. 简单编码。
    单纯逻辑的编码才能最简单，不易出错也易于修复。

3. 逻辑设计。
    将程序的编码设计转移到逻辑设计上来。
    错误的解决路径实际上会是逻辑不通，因此更易及早地发现错误。

结果：
程序是一个逻辑集合，而非编码集合。编码仅为逻辑服务。


### 三点式安全支付

对于某个特定的私钥：

1. 热钱包：存储一个随机种子数（32字节，固定）、公钥，负责构造交易和广播。**不存储私钥**。
2. 冷钱包：存储另一个**随机种子数**，负责即时构造私钥和签名。拥有画面（二维码）读取能力，需要读取交易的待签名消息哈希。
3. 中介屏：可安全读取交易的完整数据（如屏读Base64），重构交易，供用户**人工复核**。向冷钱包提供待签名**消息哈希**。

签名过程：

1. 热钱包构造交易，向冷钱包展示**随机种子值**，向中介屏展示**交易内容**。
2. 中介屏解析交易内容，重构为阅读友好的交易详情，用户**人工复核**。内容无错后向冷钱包展示待签名**消息哈希**。
3. 冷钱包用两个随机种子数即时**构造私钥**，读取中介屏的待签名消息哈希，完成**签名**。
4. 签名数据提供给热钱包，热钱包向网络**广播交易**。

安全分析：

1. 假设热钱包被劫持，攻击者完全控制了热钱包：交易内容可能被偷换，因此**不能**由热钱包**直接提供**待签名的**消息哈希**。这就是中介屏的作用。
2. 假设冷钱包丢失或被盗（用户应当有备份，至少随机种子数备份）：因为冷钱包并不存储私钥，盗取者也无法构造私钥，所以是安全的。
3. 中介屏是通用设备，并不存储任何安全性数据。如果是屏读模式，则也可以是离线的。临时借用也问题不大。
