## 版权登记

### 用例

版权声明类似于存在性证明，但版权登记通常是监管系统的要求。与存在性证明类似，版权声明同样需要「交易过期」特性的支持。


### 操作

类似于存在性证明，版权声明分两步执行。

1. 先发布一笔版权声明交易（管理者交易），提供版权物说明和附件ID的合并哈希摘要。
2. 版权声明交易进入区块并等到交易过期时段后，发布一笔存证交易，包含版权物说明和可能有的附件，并包含跳转到监管脚本的逻辑。
3. 转移该版权凭信（花费）。如果版权实际上无需转移，可置位凭信描述配置里的销毁标记。


### 脚本

#### 版权声明（管理者交易）

```go
IN{Receiver}                    // 接收者（仅登记需要）
IN{Description}                 // 取版权物说明入栈
IN{Attachment}                  // 取附件ID入栈

TOPS[2]                         // 引用栈顶2项为实参
GLUE                            // 内容合并
FN_HASH256                      // 计算哈希摘要
DATA{<hashResult>}              // 预先置入目标哈希结果
EQUAL PASS                      // 两个哈希值比较，相等则通过

// 以下可选。
// 需要进行监管登记才需要。
SCRIPT                          // 截止当前位置脚本指令序列（监管验证）

@POPS[4]                        // 取出栈顶4项（接收者、说明、附件ID、脚本片段）
GOTO[<Height>, <TxID>, <n>]     // 跳转到监管者的登记脚本
```


#### 版权物（存证）

等上面的版权声明交易进入区块，并已经过了足够的时间（交易过期时段）后，即可发布证明物本身。

版权物通常是一个文件，作为交易的附件存在。如果内容短小，存证交易中的说明字段空间足够容纳，也可以没有附件。

```go
// 跳转到版权声明交易
// 版权声明定位：区块高度, 交易ID, 输出序位
// 嵌入执行验证
JUMP[<Height>, <TxID>, <Index>]

@TEXT{It is done.} PRINT    // 友好打印

@ENV{TxID} OUTPUT BUFDUMP   // 取当前交易ID，导出触发外部应用。可选
```


#### 监管登记（管理者交易）

如果版权证明需要登记，可以跳转到本管理者交易。

需要验证版权声明脚本格式的合法性，否则无法区分登记信息是否为伪造者抢注。

```go
ENV{InGoto} PASS                // 应当由GOTO跳转过来

MODEL{                          // 模型验证（栈顶项即为源脚本）
    IN{Receiver}                // 严格匹配，下同
    IN{Description}
    IN{Attachment}
    TOPS[2] GULE FN_HASH256
    DATA[32]{?}                 // 哈希结果任意，但等长匹配
    EQUAL PASS                  // 严格匹配
}

@POPS[3] OUTPUT BUFDUMP         // 取登记信息（3项），导出并触发监管登记进程
```

这是监管机构发布的一笔管理者交易。

> **登记流程：**
> 0. 由对版权物（交易）的验证开始。
> 1. 首先跳转（`JUMP`）到版权声明交易，验证其是否合法（`PASS`）。
> 2. 在该声明交易中跳转（`GOTO`）到本交易，执行登记操作。
