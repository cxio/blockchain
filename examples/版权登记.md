## 版权登记

版权声明类似于存在性证明，但版权登记通常由监管系统执行，由版权物凭信的转移触发。


### 流程

1. 先发布一笔版权声明交易（介管），提供版权物说明和附件ID的哈希验证逻辑。
2. 等待版权声明交易被收录并经过足够时间（交易过期时长），发布版权物凭信交易，并包含跳转到监管脚本（登记）的逻辑。
3. 转移（花费）该版权物凭信，触发公共验证逻辑（监管机构监听&登记）。


### 脚本

#### 版权声明（介管）

验证主脚本所在输出项的版权内容是否符合预期。

```go
OUT{Description}        // 版权物描述
OUT{Attachment}         // 附件ID
TOPS[2]                 // 引用栈顶2项（复制，原值用于后阶处理）
ADD                     // 栈顶2项串接
FN_HASH256              // 计算哈希摘要
DATA{<hashResult>}      // 预置哈希结果
EQUAL                   // 两个哈希序列比较
PASS                    // 符合预期时通过
```


#### 版权物（凭信）

版权物通常是一个文件，其作为交易的附件，交易中仅包含一个附件ID。

```go
SYS_CHKPASS             // 系统内置验证

// 嵌入版权声明并验证
EMBED[<Year>, <TxID>, <Index>]
@POPS[2]                // 提取信息（描述、附件ID。即TOPS原值）

// 转到监管登记脚本
GOTO[<Year>, <TxID>, <n>]
END                     // 结束公共验证，以下私有

@ENV{TxID}              // 取当前交易ID
OUTPUT BUFDUMP          // 导出并触发外部监听（交易发布者注册，获取反馈）
```


#### 监管登记（介管）

这是监管机构预先发布的一笔管理者交易。

需要验证版权声明格式以及版权花费跳转是否合规（否则无法区分是否为非法抢注）。

```go
ENV{InGoto} PASS        // 确定由GOTO跳转过来

ENV{Source1}            // 主脚本中首个外部脚本（EMBED）
ENV{Source0}            // 主脚本（版权物）

MODEL{                  // 版权物凭信验证（ENV{Source0}）
    SYS_CHKPASS         // 严格匹配
    EMBED[?, ?, ?]      // 必须为一个 EMBED
    @POPS[2]            // 严格匹配
    GOTO[?, ?, ?]       // 必须为一个 GOTO
    END                 // 严格匹配
    ...                 // 可能有的私有处理（通配）
}
PASS                    // 主脚本验证，通过

MODEL{                  // 版权声明验证（ENV{Source1}）
    OUT{Description}    // 严格匹配
    OUT{Attachment}     // 严格匹配
    TOPS[2]             // 严格匹配
    ADD FN_HASH256      // 严格匹配
    DATA[32]{?}         // 哈希结果任意，但等长匹配
    EQUAL PASS          // 严格匹配
}
PASS                    // 模式是否通过

@OUT{Receiver}          // 接收者
@POPS[2]                // 提取信息（版权物描述、附件ID）
OUTPUT BUFDUMP          // 导出并触发监管登记
```
