# 激励机制

对于一个开放的公共区块链系统来说，参与者是完全自由的，没有激励手段，自发的参与不可能形成。

在Bitcoin系统中，激励的手段有铸币奖励和交易费获利。铸币就是铸造者可以按规定的数量凭空生成比特币，这也是比特币的来源。交易费是交易被纳入区块需要支付的费用，类似银行转账的手续费。两种收益构成了Bitcoin系统运行的经济支撑。

另外有一些区块链系统，当铸币到一定总量后，系统维持一个较低的通胀率缓慢发行新币。还有一些系统仅以通胀铸币为驱动力，免除了用户的交易费。但无论如何，系统都需要经济上的驱动因子，这就是公链上不可或缺的激励机制设计。


## 原始铸币

本设计采用初期大量铸币，之后长期维持一个低通胀率铸币的模式。

初期铸币规则如下：

- 初始币量：40币/块。
- 出块间隔：8分钟。这是一个固定值。
- 递减算法：逐年递减20%。即前一年的80%，精确到币单位（而不是聪）。
- 发行时长：当递减到3币/块后，维持长期固定铸币量。

另有一个试运行期：
在最初的三年，每年递增铸币：10, 20, 30币/块。这是考虑公平性，避免可见度不高的初期，少量用户占用过多币量。

> **注：**
> 采用恒星年（365.25636日）记年，每年创建约 `65746` 个区块。

```go
年次    累计             次计               币量/块
-----------------------------------------------------------
1       657460          [657460 ]          10
2       1972380         [1314920]          20
3       3944760         [1972380]          30
-----------------------------------------------------------
5       5259680         [5259680]          40
7       9467424         [4207744]          32
9       12754724        [3287300]          25
11      15384564        [2629840]          20
13      17488436        [2103872]          16
15      19066340        [1577904]          12
17      20249768        [1183428]          9
19      21170212        [920444 ]          7
21      21827672        [657460 ]          5
23      22353640        [525968 ]          4
25      22748116        [394476 ]          3
...     // 3币/块长期微通胀……
-----------------------------------------------------------
初期三年： 3944760
减量发行： 22748116
发行总计： 26692876
```



## 通胀铸币

通胀铸币是在原始铸币结束之后，系统继续以一个微小的通胀率长期发行新币。之所以需要后期的通胀设计，是因为仅仅依靠交易费来维持矿工的积极性可能是一个问题。后期的通胀铸币其实是向全网征税，如果额度合适就是合理的。

后期的微通胀铸币被用来补充矿工的收益，考虑简单性和稳定的预期，本设计采用后期 **每区块3币** 的固定额发行方式。结合交易费的回收，以及区块铸造的低成本性，一个区块的收益还是可行的。

> #### 参考：
>
> 如果交易费只回收**50%**，则增加了一个市场变量：*部分存币被销毁*。
> 由此：
> 1. 当交易费变多时，销毁的币也变多。效果：币总量减少促使币值回升，抑制交易和交易费。
> 2. 当交易费变少时，销毁的币也减少。效果：币总量回升促使币值下降，促进交易和交易费提升。
>
> 这是一种外部市场的影响，或许有正面的意义（自平衡）。


### 区块收益

假设一个区块收纳5万笔交易，平均每笔交易的交易费为 0.00016 bi，则交易费合计 8bi。如果采用交易费折半回收的方案，加上固定的通胀铸币，一个区块可以有7bi（3+4）的收入。

但上面的折半也销毁了4个币，而通胀铸币只有3个，因此会缩减总的币量，这并不一定是好事。

因此实际上，交易费可以再低一点，比如 0.00008 bi。这样，5万笔交易费的合计为4bi。减半销毁为2个币，比通胀铸币稍低，这样就可以维持一个很低的币量微涨水平。此时一个区块的收益为 5bi（3+2）。

维持币量水平不变的销毁量是3bi，即交易费合计6bi，区块收益也是6bi（3+3）。以此反推，交易费应该在 6/50000 = 0.00012 bi。

当然，所有的结果都是市场行为，没有人能控制。

影响销毁量的是交易费水平和一个区块能收纳的交易量数量：交易量越大，交易费就可以越低，而区块收益稳定。

> #### 公共服务开支
> 在本设计中，区块链需要公共服务的支持，且同时也会对公共服务进行奖励。
> 因此区块的铸造者实际上只能获取区块收益的一半左右。



## 公共服务的激励

公共服务分离出了区块链系统的基本需求，它们应当参与到区块链的利益分配里去，这是一个顺理成章的逻辑。但这些公共服务是P2P的去中心化模式，一个逻辑严密的利益分配机制可能很难实现，因此这里采用了一个松散的利益报偿设计：**铸造者收益的一部分分配给公共服务**。


### 铸币交易的结构

区块的铸造收益在Coinbase交易里体现，这是一个特殊的交易，包含了原始铸币、交易费提取等情况。与Bitcoin不同，这里的Coinbase交易还负责对外部公共服务的奖励配置和发放（遵循固定的规则）。

铸币交易里应该包含必要的部分：

- 收益总额：铸币 + 交易费 + 兑奖截留。
- 收益地址：铸造者（校验组）、铸凭者（铸凭交易提供者）、Findings服务奖励、Blockqs奖励。
- 区块高度：明确Coinbase交易的位置。
- 定制数据：类似于Bitcoin里的Coinbase数据，为铸造者提供一些灵活性。最长255字节。
- 择优凭证：区块铸造者证明，也用于分叉之后的链段竞争时。


#### 奖励分配

对公共服务的外部奖励应该在系统中硬编码明确下来，采用简单的固定划分方式。

公共服务为2个（`Findings`, `Blockqs`），参考比例：

- **铸造者**：`54% (42 + 12)`。其中校验组 `42%`，提供铸凭交易的优胜者（铸凭者） `12%`。
- **节点网**：`18%`。Findings节点，提供节点发现的最基础网络。
- **数据网**：`28%`。Blockqs节点，提供区块相关数据存储和检索的区块链基础网络。

> **注：**
> 档案存储归入到区块查询服务里，因为档案主要是交易里的附件。


### 可能随意的局部评估

对公共服务节点的奖励需要一种抽奖机制，但公共服务是一个开放的P2P网络。如果让服务器提供某种证明来参与竞争，就需要创建一套防止作弊的可信机制，而这恰恰是区块链本身要解决的问题。设计一套安全可靠的方案既复杂成本也高，因此，这里的做法十分简单：

**区块的铸造者可以随意选择获奖者。没有抽奖！**

这里没有任何限制，铸造者可以选择自己的服务商或其它服务商，或者它们甚至都不是服务。乍一看这好像很荒唐……

奖励的选择没有限制，但兑奖不是。获奖者并不能简单地把奖金拿走，奖金的提取需要得到后续其他铸造者的认可。

兑奖规则为：

> 在后续的**60**个区块内，至少需要得到**2**位铸造者的确认才能完整兑奖。

```go
确认数  兑现比例
------------------
1       50%
2       100%
```

后续铸造者对前期奖励的确认在其铸币交易里的「兑奖槽」里标记。每一个铸造者需要对前**60**个区块内的奖励目标进行评估，如果目标所属服务器服务良好，则认可并在相应位置标记（置位），否则忽略。

每个区块的外部奖励为2个服务者（`Findings`、`Blockqs`），**60**个区块需要**120**位的标记（15字节）。即一个区块的铸造者需要评估120笔奖励的合理性。通常，这需要轮巡检查自己的*良好服务提供者*缓存集。

60个区块的评估时间段需要8个小时，但30个区块（分叉长度限制）之后即可开始兑奖（仅限于完整兑奖）。如果服务节点在这60个区块内没有得到完整数量铸造者（2名）的确认，截留部分的奖金将由下一个评估段的相应块回收（即第60个间隔那个块）。

> **注：**
> 奖励的代币需要至少等待30个区块之后才能花费（和铸造者一样），避免分叉导致的无效花费。

<!--
> #### 为何不是一个确认即可
>
> 对于公共服务的评估奖励是利益无关的，因此逻辑上一个确认即可。
> 但这里还是设计了需要2个确认才能完整兑奖。
>
> 理由有两点：
> 1. 避免铸造优势者的任性绑定。因为优势者获得再一次的铸造机会的可能性不低，他们很可能随意绑定一个并不提供服务的账户。
> 2. 对于零散服务者来说，2个确认才获得完整收益，或许能让节点把重心放在做好服务上，而不只是赌一把的心态。
>
> 增加一个确认应该能让铸造优势者更认真一些，毕竟很大概率会有损失，而提供服务又不是一件难事……

-->

#### 数据服务节点评估

请求链上随机的某个区块、附件或交易，评估服务质量。

获取的区块可以暂存，校验组也充当小型专项数据驿站，向其它请求区块的用户提供数据。这样可以让数据流更离散，网络更强壮。

比如可以30分钟评估一次，地址缓存，有效期10天。


#### Findings节点评估

向自己连接的Findings节点请求本类节点信息，建立连接。通过可连接性，正常评估。


### 局部评估的合理性

由于兑奖的约束，铸造者的随意选择其实并非真的随意，奖励给一个并不提供服务的私人地址没有用，因为其它铸造者不会知道它，而如果选择一个自己开设的服务，其实没啥可说的，因为提供了服务，而且效率和知名度也是需要付出的。

当然，这对仅仅提供公共服务却没有参与铸造的人来说有些不公，这确实是一个缺憾。但也并不是所有参与铸造的节点都会自行提供这些服务，它们需要专业的服务商。

提供良好公共服务的节点会被铸造者记住并缓存，如果铸造者奖励自己并不高效的服务器，确认数可能就不高，奖金会被截留。而如果某个专业的公共服务器强大并被很多节点喜欢，它的奖金兑现比例就应该问题不大。

P2P的逻辑是松散的，一个节点对周围节点的感知并不多，如果公共服务的节点很多，应用节点通常是就近连接，所以铸造者感知的服务节点也不会有太大的交集，因此上面设计的确认数不高。局部范围的限制是存在的，一个局部范围内固定优势的服务器可能形成垄断，但铸造者的奖励是自由的。

源于铸造者的随机性、奖励和评估的自由、以及局部范围节点连系本身的动态变化，我们认为全网范围内奖励目标的随机性是可接受的。

> **注：**
> 这种评估受限于铸造者对服务节点的观察范围，而不是在全网范围内衡量，因此称之为局部评估。


#### 附：节点评估的缓存池记忆

P2P公共服务网络的规模可能很大，这样服务节点就会非常地离散，节点需要对提供过服务的节点进行缓存，从而实现足够宽泛的确认行为。

这里假设服务网络的规模是10,000个节点，60个区块按最高2次确认，缓存池大小估算如下：

- **评估者**：`60/2 = 30`，即每1个完整确认可以由30个区块来命中。
- **缓存池**：`10000/30 ~= 333`，保持相同评估者规模需要的缓存集大小（每服务）。

这只是一个简单的概算，实际上节点的缓存中应该有大量的重叠。这需要在实际的生产运行中适当扩大缓存池记忆。网络规模越大，命中率越低。



-------------------------------------------------------------------------------

上一篇：[公共服务](3.公共服务.md)<br>
下一篇：[脚本系统设计](5.脚本系统设计.md)<br>
