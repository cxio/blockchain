<!--
>
> 人，意识；AI，义识。<br>
> 前者有情，众生之属，后者蕴义，世间万物。虽理也，其善恶无别乎～……
>
-->

# 要点

## 共识模型

### 基于历史的概率素材

交易ID是交易数据的哈希摘要，拥有无法预测的随机性。区块链上的历史交易是一些既成的事实，无法伪造。因此，籍由历史交易的ID来评选区块的铸造者，是一个看起来简单易行的做法。

由交易的历史塑造共识，共识又反过来保护交易的历史，这是一种闭环式的自我保护，十分强壮。


### 固定的出块时间

Bitcoin系统采用PoW共识，由最长链胜出，区块的出块时间无法确定。

如果出块时间固定，会带来不少好处，比如单纯地依靠时间就能计算出区块的高度，交易的确认时间也更为明确。另外，某些基于时间的功能性应用也更易于实现。

本设计中区块的出块时间固定为**8**分钟，这是一个折衷权衡。



## 公共服务

### 节点发现是一个服务网络

传统的P2P节点初始连网时，需要一个联系其它节点的信息中心（找到其它节点）。这是一种中心化的逻辑，存在单点故障或被封锁的风险。

本设计中的**节点发现**服务是一个去中心化的P2P网络，无法被封锁，也不存在单点故障的问题。如果有必要，用户可以用暴力发现的方式（无初始已知节点），遍历全网搜寻服务节点。**注**：因为目标巨大，所以暴力发现是可能的。

节点发现服务除了协助节点建立初始连接外，还集成了NAT类型探测和UDP打洞协助服务，进而成为一个通用的P2P基础设施。

**注**：通过节点协作可免去STUN服务器对双IP的要求。

> **项目：**
> *[github.com/cxio/findings](https://github.com/cxio/findings)*。


### 紧缺性感知机制下的开放式存储

交易中可以包含附件，附件可以是大文件，因此附件应当由另外的系统存储。存储大数据的系统称为数据网络。

数据网络主要执行数据信令的沟通，通过简单的**紧缺性感知**机制，实现全网的存储决策。原理是：节点向数据网络查询数据或发送探测包，其它节点响应……

**如果节点自身没有目标数据，则将请求包跳数加一后转播。如果有目标数据，则返回联系信息，转播停止。**

这样，如果目标数据存储稀少，请求会被广播得较远（跳数较高）。节点根据请求包里的跳数，权衡自己的存储策略：是否补充存储。

这是一种十分简单的感知机制，但可以协调全网的数据存储。与节点发现服务网络一样，数据网络也是P2P的。

> **项目：**
> *[github.com/cxio/depots](https://github.com/cxio/depots)*。



## 激励机制

#### 开放式奖励的兑奖约束

公共服务需要激励才能持久运行，但开放环境下的抽奖验证并不容易实现，因为作假的可能性很多，防不胜防。

本设计简单地通过「兑奖」约束来完成激励。规则为：

**区块的铸造者可以随意指定获奖服务节点，但兑奖需要得到后续区块铸造者的认可**。

这样就将抽奖资格的难以验证，转化成了可准确标记的确认数问题。



## 脚本系统

### 三种基本信元

代币（**币金**）是一种价值载体，主要用于计量。

单纯的计量其实无法充分表达信用，所以在币金之外，加入了**凭信**的逻辑。凭信只是文字描述，可转移，可包含附件。

还有一种静态的信用凭证，它们不需要转移，只要存在即可，这就是**存证**。存证是一种存在性表达，支持识别脚本以运行某种逻辑。


### 脚本指令的附参和实参空间

脚本系统依然采用Bitcoin的栈式脚本，但语法和指令更为通用和灵活。

指令采用**附属参数**（简称附参）表达与指令密切相关的属性，比如语句块的长度、跳转指令的目标、以及一些需要固化的信息等。

**实参空间**是一个技巧，让指令需要的实参可以先临时提取出来，避免栈语言中栈空间条目排挤的问题。

基于上面的技巧以及其它构造，本设计中的脚本系统具备基本的图灵完备性。


### 有限循环（Each）

出于安全考虑，Bitcoin脚本不支持循环（Loop）语法。

但作为一种通用的脚本语言，需要一定程度的图灵完备。折衷考虑，我们采用`EACH` 有限循环的方式。Each的目标是一个有限集，无法构造死循环。



## 组队校验

P2P网络上的节点是独立的，区块链的交易验证工作实际上是「单机」的逻辑。因此节点的硬件性能就制约了交易的规模。

但如果仔细观察，交易上的信用转移其实是逻辑完整的：每一笔交易都有着**独立的**可验证性，甚至每一笔输入都是独立的。因此为了处理大量的交易，我们可以以交易为单元进行分工：

*一个节点只验证少量的交易，大量的交易由不同的节点分别验证完成*。

配合恰当的分工管理和冗余复核，多机协作的**组队式**校验是可行的——这类似于一种纵向**分片**的逻辑。

> **注：**
> 校验组可以是封闭的小团体，也可以是开放的自由群。这不影响网络的去中心化特性。



--------------------------------------------------------------------------

下一篇：[共识：历史证明（PoH）](1.共识-历史证明（PoH）.md)
